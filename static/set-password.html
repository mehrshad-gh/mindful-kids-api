<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Set your password – Mindful Kids</title>
  <!-- No auto-redirect: Safari shows "invalid address" when opening mindfulkids:// if the app isn't installed. Show the page and let the user tap the button. -->
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 0; padding: 24px; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; box-sizing: border-box; }
    h1 { font-size: 1.25rem; margin-bottom: 8px; }
    p { color: #666; text-align: center; margin-bottom: 24px; }
    a { display: inline-block; background: #0D9488; color: #fff; padding: 12px 24px; border-radius: 8px; text-decoration: none; font-weight: 600; }
    a:hover { opacity: 0.9; }
  </style>
</head>
<body>
  <h1>Set your password</h1>
  <div id="mobile-view">
    <p>Tap the button below to open the Mindful Kids app and set your password.</p>
    <a href="#" id="open-app">Open Mindful Kids app</a>
    <p style="font-size: 0.875rem; color: #888; margin-top: 24px;">You need the Mindful Kids app installed on this device (download from the App Store or Google Play). If the button does nothing, open the app first, then tap the link again in your email.</p>
  </div>
  <div id="desktop-view" style="display: none;">
    <p>Open this link on your <strong>phone or tablet</strong> where the Mindful Kids app is installed. The “Open app” button only works on a device with the app.</p>
    <p style="font-size: 0.875rem;">Send yourself this link (e.g. by email) and open it on your phone, then tap “Open Mindful Kids app”.</p>
    <a href="#" id="open-app-desktop">Copy link</a>
  </div>
  <script>
    (function () {
      var params = new URLSearchParams(window.location.search);
      var token = params.get('token');
      var appUrl = token ? 'mindfulkids://app/set-password?token=' + encodeURIComponent(token) : '#';
      var isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);

      if (isMobile) {
        var link = document.getElementById('open-app');
        link.href = appUrl;
      } else {
        document.getElementById('mobile-view').style.display = 'none';
        document.getElementById('desktop-view').style.display = 'block';
        var copyLink = document.getElementById('open-app-desktop');
        copyLink.onclick = function (e) {
          e.preventDefault();
          navigator.clipboard.writeText(window.location.href);
          copyLink.textContent = 'Link copied';
          setTimeout(function () { copyLink.textContent = 'Copy link'; }, 2000);
        };
      }
    })();
  </script>
</body>
</html>
